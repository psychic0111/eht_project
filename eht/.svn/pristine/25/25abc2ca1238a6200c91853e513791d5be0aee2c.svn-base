<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="UTF-8"%>

<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jstl/fmt_rt"%>
<%@ taglib prefix="xd" uri="http://www.xd-tech.com.cn/" %>
<%
	String path = request.getContextPath();
	String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort() + path;
	String frontPath = basePath + "/webpage/front";
	String cssPath = basePath + "/webpage/front/css";
	String imgPath = basePath + "/webpage/front/images";
%>
<c:set var="webRoot" value="<%=basePath%>" />
<c:set var="frontPath" value="<%=frontPath%>" />
<c:set var="cssPath" value="<%=cssPath%>" />
<c:set var="imgPath" value="<%=imgPath%>" />

<link rel="stylesheet" href="${cssPath}/jquery.sinaEmotion.css" type="text/css">
<link rel="stylesheet" href="${cssPath}/tinyscrollbar.css" type="text/css" media="screen"/>
<script type="text/javascript" src="${frontPath}/js/plugins/jquery.tinyscrollbar.js"></script>

<div id="scrollbar1" style="height:100%;">
   <div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>
   	<div class="viewport">
   	<div class="overview" style="width:99%;">
   		
   		<!-- 记录noteList第一个目录id（用来初始化第一个目录详细内容区） -->
   		<c:set var="first" value="true"></c:set>
   		<c:set var="firstNoteId" value=""/>
		<ul id="contentListUl" style="width:100%;">
			<c:forEach items="${noteList }" var="note">
			<xd:inBlackList primaryKey="${note.id}" resource="note">
				<c:if test="${first==true }">
				<c:set var="firstNoteId" value="${note.id}"/>
				<c:set var="first" value="false"></c:set>
				</c:if>
				<li style="width:100%;">
				<div class="title" style="">
					<a href="#" onclick="viewNote('${note.id}')">
						<img src="${imgPath}/note.png" />${note.title }
					</a>
					<span onclick="restoreNote('${note.id}')" class="recycle_png" style="float:right;cursor:pointer;display:none;">
						<img src="${imgPath}/arrow_redo.png" title="恢复条目"/>
					</span>
					<input type="hidden" name="id" value="${note.id }"/>
				</div>
				<div class="contents" style="word-wrap:break-word;">
					<a href="#" onclick="viewNote('${note.id}')">
						<div class="txts">
							${note.summary}
							<br/>
							<div class="Font1">
								- <c:if test="${note.updateTime != null}">
									<fmt:formatDate pattern="yyyy-MM-dd HH:mm:ss" value="${note.updateTime }" type="both"/>
								</c:if>
								<c:if test="${note.updateTime == null}">
									<fmt:formatDate pattern="yyyy-MM-dd HH:mm:ss" value="${note.createTime }" type="both"/>
								</c:if>
							</div>
						</div>
					</a>
					<div class="state" id="note_status_${note.id}">
						<script type="text/javascript">
							AT.get("${webRoot}/noteController/front/noteStatus.dht?id=${note.id}",function(json){
								if(json.isRead == 'true'){
									$("#note_status_${note.id}").append("<img id=\"readpng_${note.id}\" src=\"${imgPath}/read.png\" /> <span>已读</span> ");
								}else{
									$("#note_status_${note.id}").append("<img id=\"readpng_${note.id}\" src=\"${imgPath}/readno.png\" /> <span>未读</span> ");
								}
								if(parseInt(json.attachmentCount) > 0){
									$("#note_status_${note.id}").append("<img src=\"${imgPath}/attachment.png\" />有附件");
								}
							},false);
						</script>
					</div>
				</div>
				</li>
			</xd:inBlackList>
			</c:forEach>
		</ul>
		<input type="hidden" value="${firstNoteId }" id="firstNodeId" />
	</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		var height = document.body.clientHeight;
		$("#scrollbar1").height(height-190);
		
		var node = zTree_Menu.getSelectedNodes()[0];
		if(node.branchId == 'RECYCLE' || node.dataType == 'RECYCLE' || node.branchId == 'RECYCLEP' || node.dataType == 'RECYCLEP'){ //回收站下
			$("span.recycle_png").show();
		}else{
			$("span.recycle_png").hide();
		}
		$('#scrollbar1').tinyscrollbar({wheelSpeed:300});
	});
</script>