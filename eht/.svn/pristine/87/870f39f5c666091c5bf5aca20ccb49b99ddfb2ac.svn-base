//分享条目 
function shareNote() {
	var note_id = $("#noteForm_id").val();
	if (note_id != null && note_id == '') {
		MSG.alert("请选择条目!");
		return false;
	}
	var htm = '<div style="width:550px;height:300px;">'
			+ '<form target="emailIframe"  action="'+webRoot+'/noteController/front/sendShareEmail.dht" method="post" onsubmit="return checkEmailShareForm();">'
			+ '<input type="hidden" value="'
			+ note_id
			+ '" name="noteid" />'
			+ '<input type="text" id="emailField" class="InputTxt3"  value=""  style=" width:65%; "/>'
			+ '<input class="Button4" type="submit"  value="发送" />'
			+ '<span id="emailmsg"></span>'
			+ '<table width=100% ><tr><td width="80%" valign="top"><div style="height:295px;overflow:auto;">'
			+ '<span  id="tempdiv"></span>'
			+ '</div></td>'
			+ '<td  valign="top"><div style="width:100%;height:295px;overflow:auto;"></div></td></tr>'
			+ '</form>' + '</div>'
			+ '<iframe style="display:none" name="emailIframe" src="'
			+ frontPath + '/note/emailStatus.jsp"></iframe>';
	easyDialog.open({
		container : {
			header : '<img src="' + imgPath + '/email_go.png" height="20"/>',
			content : htm
		},
		lock : true,
		follow : 'note_share',
		followX : 0,
		followY : 34
	});
	//绑定输入窗口事件
	$("#emailField")
			.keyup(
					function(evt) {
						if (evt.keyCode == 38 || evt.keyCode == 40
								|| evt.keyCode == 37 || evt.keyCode == 39) {
							return;
						}
						//回车添加当前输入框的值
						if (evt.keyCode == 13) {
							if (checkEmail($("#emailField"), $("#emailmsg"))) {
								
								
								var addtemp = "<span><input type='hidden' name='shareEmails' value='"
										+ $("#emailField").val()
										+ "' > "
										+ $("#emailField").val()
										+ " <img src='"+imgPath+"/34aL_046.png' onclick='cancelEmail(this)' > </span></br>";
								$("#tempdiv").prepend(addtemp);
								$("#emailField").val("");
							}
						}
						var url = webRoot+ "/noteController/front/getGroupsEmail.dht";
						var params = {
							'searchField' : $("#emailField").val()
						};
						getShareEmail(url, params);
						//绑定鼠标移动效果 
						if ($("#flttishi").html() != '') {
							$("#flttishi").show();
							var height = $(this).height();//按钮的高度
							var top = $(this).offset().top;//按钮的位置高度
							var left = $(this).offset().left;//按钮的位置左边距离
							//设置div的top left
							$("#emailMsgDiv").css("left", left);
							$("#emailMsgDiv").css("top", height + top + 3);
							$("#emailMsgDiv").show();
						}
						bindMouseOverLi();
					}).keydown(function(evt) {
				if (evt.keyCode == 13) {
					return false;
				}
			});
}
function cancelEmail(o) {
	$(o).parent().remove();
}
//jquery验证邮箱
function checkEmail(email, msg) {
	if ($(email).val() == null || $(email).val() == "") {
		msg.html("<font color='red'>不能为空！</font>");
		return false;
	}
	if (!$(email).val().match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)) {
		$(msg).html("<font color='red'>格式不正确！</font>");
		$(email).focus();
		return false;
	}
	msg.html("");
	return true;
}
//绑定鼠标效果事件
function bindMouseOverLi() {
	$("#prevTrIndex").val("-1");//默认-1     
	$("#flttishi li")
			.mouseover(function() {//鼠标滑过    
				$(this).addClass("over");
			})
			.mouseout(function() { //鼠标滑出    
				$(this).removeClass("over");
			})
			.each(function(i) { //初始化 id 和 index 属性    
				$(this).attr("id", "li_" + i).attr("index", i);
			})
			.click(
					function() { //鼠标单击（添加当前选择的目标）
						$("#emailMsgDiv").hide();
						var addtemp = "<span><input type='hidden' name='shareEmails' value='"
								+ $(this).find("input[name='shareEmails']")
										.val()
								+ "' > ["
								+ $(this).find("input[name='shareName']").val()
								+ "]<font color='#DADADA'>"
								+ $(this).find("input[name='shareEmails']")
										.val()
								+ "</font> <img src='"+imgPath+"/34aL_046.png' onclick='cancelEmail(this)' > </span>";
						$("#tempdiv").prepend(addtemp);
						$("#emailField").val("");
					});
	clickLi(0);
}
//获取共享邮件
function getShareEmail(url, params) {
	$.ajax({
				type : "POST",
				url : url,
				data : params,
				dataType : "json",
				success : function(result) {
					//新元素重新绑定
					if (result.data == null || result.data.length <= 0) {
						$("#flttishi").hide();
						$("#flttishi").html("");
						;
						$("#emailMsgDiv").hide();
					} else {
						//var jsonData = eval(result);//接收到的数据转化为JQuery对象，由JQuery为我们处理  
						var str = "";
						$.each(result.data,
										function(index, objVal) { //遍历对象数组，index是数组的索引号，objVal是遍历的一个对象。  
											var temp = "<li><input type='hidden' name='shareEmails' value='"
													+ objVal.email
													+ "'> <input type='hidden' name='shareName' value='"
													+ objVal.name
													+ "'> "
													+ "["
													+ objVal.name
													+ "]"
													+ objVal.email + "</li>";
											str += temp;
										});
						$("#flttishi").html(str);
						bindMouseOverLi();
					}
				}
			});
}
function clickLi(currTrIndex){
    var prevTrIndex = $("#prevTrIndex").val();    
    if (currTrIndex > -1){    
           $("#li_" + currTrIndex).addClass("over");    
    }    
    $("#li_" + prevTrIndex).removeClass("over");    
    $("#prevTrIndex").val(currTrIndex); 
} 

//表单提交前验证
function checkEmailShareForm(){
	if ($("#emailField").val() == null || $("#emailField").val() == "") {
		msg.html("");
		return true;
	}
	if (!$("#emailField").val().match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)) {
		$("#emailmsg").html("<font color='red'>格式不正确！</font>");
		$("#emailField").focus();
		return false;
	}else{
		var addtemp = "<span><input type='hidden' name='shareEmails' value='"
			+ $("#emailField").val()
			+ "' > "
			+ $("#emailField").val()
			+ " <img src='"+imgPath+"/34aL_046.png' onclick='cancelEmail(this)' > </span></br>";
			$("#tempdiv").prepend(addtemp);
			$("#emailField").val("");
	}
	msg.html("");
	return true;
}

function sendMsg(msg){
	   if(msg=="true"){
		   msg = "<font color='green'>发送成功!</font>";
	   }		 
	   if(msg=="false"){
		   msg = "<font color='red'>发送失败!</font>";
	   }
	   $("#emailmsg").html(msg);
} 
//===========================条目共享   end=========================